<html>
	<head>
		<title>Sample Page | UX capture</title>

		<!-- don't do this in production, but inline it instead -->
		<script src="../lib/ux-capture.min.js"></script>

		<script>
			// sample custom reporter function for collected measures
			const customMeasureRecordingFunction = name => {
				// there can be multiple entries with the same name, get the latest
				const measure = performance
					.getEntriesByType('measure')
					.filter(entry => entry.name === name)
					.pop();

				if (typeof measure.duration !== 'undefined') {
					// in real world you might be sending this to your custom monitoring solution
					// (because it does not support W3C UserTiming API natively)
					console.log('Measure', name, ':', measure.duration);
				}
			};

			// universal selector used for all zones
			// this can encorporate established site-wide pattern like using classes to denote elements
			const universalElementSelector = element =>
				document.querySelectorAll(`.ux-capture-${element.name}`);

			window.UXCapture.create({
				onMeasure: customMeasureRecordingFunction,
				elementSelector: universalElementSelector,
			});

			/**
			 * Array of zone objects groupping elements together
			 *
			 * window.UXCapture.startView([
			 * {
			 *  name: "ux-destination-verified",
			 *  elements: ...
			 * }
			 * ]);
			 *
			 * Using elements array with elementSelector and optional expectedElements properties
			 * will allow you to automatically detect already rendered elements and zones during startView() call
			 * in interactive views.
			 *
			 * Each element is marked using UserTiming and selectors
			 * elements: [{
			 *  // [<string>] - names of marks to expect for this element
			 *  marks: ["ux-image-logo-onload", "ux-image-logo-inline"],
			 *
			 *  // <string|function> - string is an input to document.querySelectorAll()
			 *  //                     or function that returns a collection of DOM nodes.
			 *  // Used to detect if elements are already on the page on SPA transition
			 *  // and for highlighting during debugging
			 *  elementSelector: "h1",
			 *
			 *  // <number|function> - number is used to compare to return of elementSelector
			 *  //                     or function that returns a boolean indicating if element
			 *  //                     is already displayed and functional
			 *  // default: 1
			 *  expectedElements: 2
			 * }]
			 */
			window.UXCapture.startView([
				{
					name: 'ux-destination-verified',
					elements: [
						{
							name: 'title',
							marks: ['ux-text-title'],
						},
					],
				},
				{
					name: 'ux-primary-content-displayed',
					elements: [
						{
							name: 'intro',
							marks: ['ux-text-intro'],
						},
						{
							name: 'story',
							marks: ['ux-text-story'],
						},
						{
							name: 'kitten',
							marks: ['ux-image-onload-kitten', 'ux-image-inline-kitten'],
						},
					],
				},
				{
					name: 'ux-primary-action-available',
					elements: [
						{
							name: 'details',
							marks: ['ux-text-story-details-link', 'ux-handler-moreclickable'],
						},
					],
				},
				{
					name: 'ux-secondary-content-displayed',
					elements: [
						{
							name: 'page2-link',
							marks: ['ux-text-page2'],
						},
					],
				},
			]);
		</script>
	</head>

	<body>
		<h1 class="ux-capture-title">UX Capture library sample page</h1>
		<script>
			window.UXCapture.mark('ux-text-title');
		</script>

		<div id="content">
			<p class="ux-capture-intro">
				<img
					class="kitten"
					src="kitten.jpg"
					style="float: left; margin: 0 1em 1em 0"
					width="30%"
					onload="window.UXCapture.mark('ux-image-onload-kitten')"
				/>
				<script>
					window.UXCapture.mark('ux-image-inline-kitten');
				</script>
				Decide to want nothing to do with my owner today. When in doubt, wash being
				gorgeous with belly side up sweet beast, but poop in the plant pot but munch
				on tasty moths. Brown cats with pink ears. Caticus cuteicus when in doubt,
				wash stare at ceiling, and scream at teh bath, lies down but cough hairball on
				conveniently placed pants claw your carpet in places everyone can see - why
				hide my amazing artistic clawing skills?. Meow in empty rooms.
			</p>
			<script>
				window.UXCapture.mark('ux-text-intro');
			</script>

			<script>
				// delaying this loop a tiny bit to show the difference
				var y = 0;

				for (var i = 0; i < 100000; i++) {
					y += i;
				}
			</script>

			<p class="ux-capture-story">
				Bacon ipsum dolor amet jowl swine brisket, drumstick pig chicken meatball ham
				hock ham salami andouille hamburger. Ribeye alcatra porchetta flank. Venison
				chicken meatloaf landjaeger. Porchetta burgdoggen ham hock, pork belly beef
				ribs chicken meatloaf jowl strip steak t-bone. Pork chop turducken drumstick
				kevin leberkas jowl chicken prosciutto salami meatloaf, tri-tip doner boudin
				ground round
				<a href="story-details.html" id="morelink" class="ux-capture-details"
					>read more...</a
				>
				<script>
					window.UXCapture.mark('ux-text-story-details-link');
				</script>
			</p>
			<script>
				window.UXCapture.mark('ux-text-story');
			</script>

			<p>
				Lorem non. Aperiam exercitationem omnis. Consequatur rem labore architecto. Ad
				molestiae explicabo but nemo for doloremque. Aliquip dolor, yet velitesse so
				omnis vitae aspernatur. Modi. Aliqua.
			</p>

			<a href="page2.html" class="ux-capture-page2-link">Page 2 &gt; &gt;</a>
			<script>
				window.UXCapture.mark('ux-text-page2');
			</script>
		</div>

		<script>
			// emulating a long-running JS event attachment, e.g. React re-hydration
			setTimeout(() => {
				document.getElementById('morelink').addEventListener('click', function(e) {
					e.preventDefault();

					alert('More kittens there');
				});

				window.UXCapture.mark('ux-handler-moreclickable');
			}, 300);

			// mini-SPA
			document.querySelector('a[href="page2.html"]').addEventListener('click', e => {
				e.preventDefault();

				// triggers initial mark
				UXCapture.startTransition();

				document.getElementById('content').innerHTML =
					'<i>... loading page 2 ...</i>';

				setTimeout(() => {
					// sets new view expectations
					UXCapture.startView([
						{
							name: 'ux-destination-verified',
							elements: [
								{
									marks: ['ux-text-title'],
									// CSS selector, same as () => document.querySelectorAll('h1')
									elementSelector: 'h1',
								},
							],
						},
						{
							name: 'ux-primary-content-displayed',
							elements: [
								{
									marks: ['ux-text-page2-content'],
									elementSelector: '#page2content',
								},
							],
						},
					]);

					setTimeout(() => {
						document.getElementById('content').innerHTML =
							'<p id="page2content">SPA transition to page 2 successful</p>';

						UXCapture.mark('ux-text-page2-content');
					}, 900); // 1s delay between startTransition() and Primary Content Available
				}, 100); // 100ms delay between startTransition() and startView();
			});
		</script>
	</body>
</html>
